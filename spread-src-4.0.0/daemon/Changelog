Wed Nov 29 23:02:30 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* All source: Update copyright header to include Claudiu
	Danilov.

Mon Nov 20 16:06:45 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* arch.h: Windows portability. Do not define byte, as it
	already exists as typedef. Do define MAXHOSTNAMELEN as 
	windows does not include it. Report and fix by Jacob Green.

Sun Nov 19 16:58:13 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* sp.c (SP_scat_receive):  Add missing Mutex_unlock() calls
	before return(ILLEGAL_MESSAGE) calls. Fix deadlock reported
	by Massimo Feola for 3.17.3. Also present in 4.

Sun Nov 19 13:10:00 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>
	* libspread/fl.c, stdutil/* (many): Update to stdutil 
	version 1.0.0beta6.
	
	Fixup flush library to use new stdutil stderr_output() 
	function instead of stderr_abort() or _msg().

Sun Nov 19 15:13:47 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* sess_body.h, groups.h, groups.c (group,G_build_groups_buf): 
	Fix big-endian bug caused by int->char memcpy. 
	group->changed field is now a boolean instead of int.
	Value sent in GROUPS message is an int16u to have fixed size.
	Use GROUPS_BUF_* macros instead of recalcuating size.

	Split into a version that returns changed status as a bool
	and a void return for G_eliminate_partitioned_members().
	Rename G_check_synced_set to void G_update_synced_set() and
	bool G_update_synced_set_status().
	Change return value of G_check_if_changed_by_cascade() to bool.
	Use bool types for all 'changed' type variables.

Fri Nov 17 13:43:42 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* network.c (Net_init): Do not bind to broadcast address
	on windows,as it is not permitted. Sockets bound to specific
	interfaces on windows will also receive broadcasts. Bug 
	reported by Michael Chelnokov.

Fri Nov 17 13:36:12 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* groups.c (G_mess_to_groups,G_build_groups_buf): Fix race
	condition bug that caused group members on different daemons
	to see different group_id's for the same group. Bug analysis,
	testing and diagnosis by John Schultz and Ryan Caudy. Final 
	patch by Jonathan.

Wed Nov 15 10:27:33 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* sp.c (connect_nointr_timeout): Move wait_timeout 
	initialization up so it always happens, even for blocking.

Tue Nov 14 03:40:43 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* arch.h, groups.c, memory.h: Make memory.h inline function
	declarations extern. Move Alarm() in groups to after endian 
	flip of data. Define inline correctly for non gcc platforms.

Tue Nov 14 01:40:43 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* sp.c (SP_connect_timeout): Rename variables to make more 
	readable. Define length of spread_name parameter in terms
	of MAXHOSTNAMELEN because it is determined by how large a 
	host name can be. 

	Define the default spread connection port (4803) in terms 
	of the DEFAULT_SPREAD_PORT to remove explicit port number
	from source code.

	* arch.h: Add Q() and QQ() macros in order to make strings 
	from #define macros.
	
Tue Nov 14 00:38:14 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* sp.c (connect_nointr_timeout): Fix bug where tv_sec was
	used instead of tv_usec. Patch supplied by Daniel Savarese.

Mon Nov 13 19:30:30 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* groups.c (G_compare_daemon_vs_set): Fix compile warning
	by adding const to type of comparision variables.

Mon Nov 13 19:28:33 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* arch.h: Fix byte type to correctly be defined on all 
	platforms as an unsigned 1 byte value. Problem reported by 
	John Schultz.

Mon Nov 13 18:14:05 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* sample.spread.conf: Remove {} around EventPriority value
	as they should not be used since it is only a single value.
	Bug reported by Matt Garmen.

Mon Nov 13 16:53:13 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* defines.h: Use socklen_t for platforms that have it and
	don't have sockopt_len_t (fixes build error on Mac OS X 10.4.)

Tue Sep 12 18:06:27 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* protocol.c, membership.c, prot_body.h, spread_params.h 
	(Prot_handle_token,Read_form2): If token rotates too many
	times during EVS state, trigger a membership change to 
	recover. This works-around a rare case of the daemon getting 
	stuck in EVS state for an unknown reason. 
	Original patch by John Schultz.

Sun Jun  4 01:01:51 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* Makefile.in (SHARED_STDUTIL): Change libspread.so target
	to merge stdutil library objects directly by including the 
	object files rather then linking in the stdutil archive. This
	fixes the linking problem for platforms which require -fPIC
	for all shared library code. Specifically this fixes the build
	failure on x86-64/linux. 

Wed Mar  1 08:05:32 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* libspread/sp.c, fl.c, include/sp.h, sp_func.h (SP_get_vs* memb_info()):
	Add new membership parsing functions SP_get_memb_info(),
	SP_get_vs_sets_info() and SP_get_vs_set_members() to analyze
	the contents of the mesage body of membership messages. 
	Deprecate old functions that just gave byte locations within 
	body as they are too confusing. 
	* examples/user.c, simple_user.c: Update example programs
	to use new membership parsing functions.

Wed Feb  8 03:44:23 2006  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* arch.h: Add HAVE_STRERROR for Windows builds. This avoids
	a compile error with shared DLL libraries. Discovered and 
	fixed by Jacob Green.

Tue Feb 07 11:31:42 2006 Jonathan Stanton <jonathan@spreadconcepts.com>

	ifdef out debugging code to avoid compile warning.

Tue Jan 17 18:49:00 2006 John Schultz  <jschultz@spreadconcepts.com>

	Final bugfixes for StdUtil/Flush.  Primary bugs were in
	doubly linked list of StdUtil, passing switched parameters
	and decrementing something and then using it rather than
	the other way around.

Fri Sep 23 13:09:01 2005 Jonathan Stanton <jonathan@spreadconcepts.com>
	
	Fixes for compile warnings and type misdetection in
	configure script. Fixes type-punning dereferences caught by
	new strict aliasing warning by using correct "struct
	timeval" for select calls timeout.Does NOT disable new gcc
	4.0 strict-aliasing optimization, as it might be safe with
	these fixes.

Wed Sep 21 01:00:31 2005 Jonathan Stanton <jonathan@spreadconcepts.com>
	
	Fix 'make install' target. Inspiration by Neil Conway's
	patch for install.Also change default spread library (with
	FL interface) to libspread. libtspread.* does not exist
	anymore. The basic libspread is now threadsafe. The core
	libraries (libspread-core and libtspread-core) still exist
	as a single-threaded and a thread-safe version.

Mon Sep 19 17:31:52 2005 Jonathan Stanton <jonathan@spreadconcepts.com>

	Apply fix (with small change) from Neil Conway for
	unnecessary char -> int cast.

Mon Sep 19 17:26:32 2005 Jonathan Stanton <jonathan@spreadconcepts.com>

	Apply fix from Neil Conway to change incorrect usage of
	vsprintf to sprintf.

Thu Sep 08 10:56:53 2005 Jonathan Stanton <jonathan@spreadconcepts.com>

	Apply warning fix patch from Neil Conway.Add configure
	check for pthread_atfork function so it will only be used
	if supported by pthread library.If it does not exist, then
	forking threaded spread client programs is not safe from
	deadlocks.

Thu Sep 01 15:27:47 2005 John Schultz  <jschultz@spreadconcepts.com>

	Fix to stdhash and minor changes in hash/cmp fcns in flush.
	Still needs more work and testing.

Tue Aug 30 09:19:47 2005 Jonathan Stanton <jonathan@spreadconcepts.com>

	Fix for dynamic conf bug that caused crash with corrupted
	Cn struct.Reported by Jacob Green.

Wed Aug 24 10:00:15 2005  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* All.c: Update copyright notice to include new contributors
	and dates. Update version number for 4.0.0 release.
	
Wed Aug 17 10:00:15 2005  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* sp.c (sp_atfork_child,sp_atfork_parent,sp_initialize_locks): 
	Add pthread_atfork handlers to 
	reset mutexes when a client process is forked. They
	also cause the Struct_mutex to be held over the fork. This 
	currently only handles pthread based threading and not
	Windows based threading. 

Wed Aug 17 18:30:48 2005 Jonathan Stanton <jonathan@spreadconcepts.com>

	Remove configure.in build of flush/Makefile as it no longer
	exists.Add additional linker commands to build of
	libtspread.so so stdutil is included.

Tue Aug 16 16:26:52 2005 Jonathan Stanton <jonathan@spreadconcepts.com>

	Finish moving flush sample programs and library info final
	location.Build of flush is now integrated with spread
	library build.libtspread.a now contains FL_ and SP_
	interfaces.libspread-core.a and libtspread-core.a now
	contain the original SP_ spread interface.

Tue Aug 16 13:45:55 2005 Jonathan Stanton <jonathan@spreadconcepts.com>

	Fix bugs in hash checks that prevented some memberships
	from completing.Allow monitor messages to always pass hash
	checks.

Tue Aug 09 22:07:49 2005 John Schultz  <jschultz@spreadconcepts.com>

	Fixed bugs of omission in stdutil: somehow got left out in
	last check in.	Fixed two minor bugs (that I introduced) in
	groups.c, one was an improper skiplist erase and the other
	was improperly reporting # of target sessions in G_analize
	groups.  The flush change was just white space.

Mon Aug  8 00:11:24 2005  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* sp.c (SP_kill): Make SP_kill() a public function so apps
	can close unneeded FD/mboxes without disconnecting. Also
	change socket error handling so sockets are not closed when
	errors occur, but app is notified and must call 
	SP_disconnect() to clean up mbox before reusing. This helps
	threaded apps correctly handle closed fd's without races.

Sun Aug  7 19:36:54 2005  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* sp.c (SP_get_local_vs_set_offset_memb_scat): Add function
	to get local vs set offset if SP_receive_scat() is used
	to get membership messages.

Sun Aug 07 18:54:26 2005 Jonathan Stanton <jonathan@spreadconcepts.com>

	Merge build/Makefile/configure for flush with Spread. Also
	fixup integration withstdutil build setup. Spread, Flush
	and Stdutil should build from a separatedirectory tree now.

Fri Aug 05 19:18:38 2005 John Schultz  <jschultz@spreadconcepts.com>

	Added final code to flush to handle Spread's new vs_set
	semantics.  Added FL_lib_init calls to user and
	fl_time_memb as needed.  I still need to add documentation
	about FL_lib_init, this will probably break most deployed
	FL apps.  Exported an additional offset fcn in sp_func.h;
	probably need another one for scat structs.  Updated sp.c
	to have matching fcn prototypes.  Possible bug still in the
	SP_get_local_vs_offset fcn.

Sun Jul 31 06:51:40 2005 John Schultz  <jschultz@spreadconcepts.com>

	Added in flush code (still needs to conform to new Spread
	semantics) as best I thought appropriate.  Minor comments
	added to groups.c.

Thu Jul 28 10:50:56 2005 John Schultz  <jschultz@spreadconcepts.com>

	Removed iterators from sess_body.h structures and
	insert/removals.  Changed all skiplist's to function as
	unique key sets (i.e. - no values): this requires that the
	members used for key comparison in the referenced structs
	are the first members of those structs.  Changed
	grp->mboxes to be an unsorted dynamic array (stdarr). 
	Changed G-analize_groups to be more like it was before, but
	I "upgraded" it a bit, it should be slightly faster now
	than before.  Added some comments for clarity and potential
	future work in TODO and FIXME comments.

Fri Jul 22 04:40:34 2005 John Schultz  <jschultz@spreadconcepts.com>

	Major changes to groups.c -- converted to use stdutil
	skiplists rather than Theo's.  Removed old skiplist code. 
	Compiles but not tested yet.

Fri Jul 15 11:46:05 2005 Jonathan Stanton <jonathan@spreadconcepts.com>
	

	Fix version configuration hash check to only check
	major/minor versionnot patchlevel as different patchlevels
	should interoperate.

Fri Jul 15 11:42:01 2005 Jonathan Stanton <jonathan@spreadconcepts.com>

	Update Java build to use new directory layout. 

Fri Jul 15 10:51:21 2005 Jonathan Stanton <jonathan@spreadconcepts.com>

	Update Makefiles and configure script to build John's
	stdutil package that was merged andto set the spread
	version number correctly.

Sat Jul 09 18:49:04 2005 Jonathan Stanton <jonathan@spreadconcepts.com>

	Updated Makefiles, Windows project files and configure
	script to support new directory structure.Also update
	CVS_Readme.txt and Readme.txt files about newstructure.

	Move example programs and public include headers.Copy
	makefiles and configure script to begin build fixes.

Wed Jun  1 16:05:34 2005  Jonathan Stanton  <jonathan@cnds.jhu.edu>
 
 	* session.c (Sess_init): Change ACTIVATE_PORT_REUSE() from 
 	#define macro to regular function Sess_activate_port_reuse().
 
Mon May  30 15:26:57 2005  Jonathan Stanton  <jonathan@cnds.jhu.edu>
 
 	* monitor.c: Add "Reload" command to menu. This sends a packet
 	with type RELOAD_TYPE to all daemons to trigger a conf file
 	reload.
 	
 	* log.c, membership.c, session.c:
	Remove all static copies of the  My struct from Conf_my()
 	to avoid old .seg_index and .index_in_seg values when conf changes.
 	
 	* flow_control.c, log.c, network.c, membership.c, status.c: 
 	Use dynamic refs to Conf instead of static copies. 
 	Cleanup conf use to use functions instead of direct data
	structure access when possible.
 
 	* configuration.c (Conf_reload_initiate): Add function to reload
 	configuration files and parse what type of changes were made
 	to the configuration to know if a singleton partition is needed.
 
 	* membership.c (Lookup_new_members): Change name to
	Memb_lookup_new_members() and make public function.
 
	* configuration.c, conf_body.h, config_parse.y: Make Config and
 	Config_procs pointers instead of static structures so they can be
 	reallocated upon config reload. 
 
 	* configuration.c (Conf_in_reload_state): Add Conf_reload_state_*() 
 	functions to query, set and reset the state. Should be true when
 	configuration is being reloaded to prevent other operations that
 	might interfere. 
 
 	* conf_body.h: Remove skiplist.h and unused Skiplist declarations.
 
 	* configuration.c, configuration.h (Conf_init, Conf_load_conf_file):
 	Change return value to void since not used. Store filename and 
 	hostname provided by user on command line in static buffer in 
 	configuration so it can be used for later reloads of conf file.
 	
 	* network.c, network.h (Net_signal_conf_reload): Add method to 
 	signal network layer to configuration change. 
 
 	* network.c, network.h (Net_recv): Make public Set_partition(), 
 	Clear_partition() interface.
 

Thu Apr  7 23:47:37 2005  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* groups.c (G_handle_reg_memb): Fix misplaced closing } for
	else case. Bug introduced in october groups rewrite, but 
	effectively benign becaues of switch/case. Fixed by Jonathan.

Wed Apr  6 23:41:44 2005  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* protocol.c (Answer_retrans,Send_new_packets,Prot_handle_token): 
	Remove all use of Wide_delay.
	This only added extra delay when sending if we though the network
	was a WAN. Originally this helped deal with high loss levels on 
	the Internet (circa 1993) However, it appears no longer needed
	and actually hurts performance.

Thu Mar 31 23:44:04 2005  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* sp.c (SP_internal_multicast): Check for short writes on network 
	socket sends and loop to finish full write. Bug reported by Tudor Dumitras.

Sun Mar 20 17:45:49 2005  Jonathan Stanton  <jonathan@cnds.jhu.edu>
 
 	* spread.c (main): Only print Alarms of SPLOG_INFO or higher priority by default.
 
Sun Mar 20 12:12:53 2005  Jonathan Stanton  <jonathan@cnds.jhu.edu>
 
 	* conf_body.h, membership.c, configuration.c, protocol.c, config_parse.y, net_types.h:
 	Create string representation of spread.conf segment entries and compute
 	32 bit hash of string. Hash is stored in Config structure and is checked
 	when membership messages or tokens are received. received hash must equal
 	local hash.
 
 	* configuration.c: remove old parser code that was ifdef 0.
 	
 	* configuration.h, configuration.c: 
 	Split Conf_init into Conf_load_conf_file to begin dynamic conf support.
 	
 	* membership.c: Print formatted IP addresses in Memb_handle_message alarms.
 
Thu Dec 02 23:50:27 2004   Ryan Caudy  <rcaudy@gmail.com>

	* groups.c (G_build_groups_buf): Fix groups-state-exchange 
	message building code, to take the message_header into account, 
	and hence avoid a potential 48 byte buffer overflow. 
	This bug was manifested as an overwrite of My.name.
	Patch by Ryan Caudy.

	* javalib/SpreadConnection.java (stopListener): Changed routine 
	that removes listener thread to call join on the thread after 
	instructing it to exit, to avoid a race-condition when disconnecting. 

	* javalib/SpreadConnection.java (readAuthMethods): Also, 
	corrected handling of one-byte return codes received with
	InputStream.read(byte), to correctly display/examine negative 
	numbers.

Mon Nov 01 20:26:13 2004  Ryan Caudy  <rcaudy@gmail.com>
	* groups.c (G_Build_groups_buf): Fixed bug in G_build_groups_buf 
	where daemon iterator wasn't set properly.

Fri Oct 29 01:18:05 2004  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* groups.c, groups.h,sess_body.h,objects.h,sp.c,sp.h,user.c: 
	Apply Ryan Caudy's major Group change to support multiple VS set reporting.

	* javalib/Membership.java, javaapps/User.java, javaapps/recThread.java:
	Apply Ryan's change to java library to support VS sets. Change the
	example code of User to print out the new membership info. 

Fri May 07 10:53:03 2004  Ryan Caudy  <rcaudy@gmail.com>

    * Add multiple VS (virtual synchrony) sets to regular membership messages at
    SP interface. These show all that is known about which members were
    virtually synchronous with one another during their previous regular
    memberships.  ***Breaks client compatibility for regular membership
    messages.***

    * Use a representative based group message exchange.
    This allows merging partial states if both parties are complete in
    a cascading case. The two points this can occur are G_handle_reg_memb and
    G_compute_and_notify.

    * Stop throwing away useful information:
      - No longer delete currently up-to-date groups state at G_Compute_notify.
      	This allows each daemon to not process groups messages from their
      	representative.  Allows a much better performance for large numbers of
      	group memberships.
      - If rep state (2) applies then do not drop groups state on cascade, but
      	instead process the messages and proceed under a single representative.
      As a result the GROUPS message has changed and the heavy weight client
      membership message format has chagned.  The lightweight client membership
      message has not changed, except small syntax changes to be consistent.

    * Fixes: include last fall's group_id fixes.

    * Change the order of members in membership messages to be by daemon name,
    then member name, where daemosn are ordered as in conf file.

    * Groups skiplist in memory now has 3 layers (group-daemon-member).

    * Remove NEW state for groups -- it is obselete.

    * Lots of cleanups and creation of X_send_mess() functions that encapsulate
    all the common sending code.

    * Send heavyweight membership messages followed by transitional membership
    messages for leaves and disconnects from changed groups in GTRANS, instead
    of notifying in the next heavyweight membership message.  This changes the
    sending of these membership message types be the same as that for joins.

    * The C and Java library and example code have been updated to reflect the new
    regular membership message format.


Fri Oct 29 10:53:03 2004  Jonathan Stanton  <jonathan@cnds.jhu.edu>

	* groups.c: Move assignment of this_group out of assert() call.

October 15, 2004 Ver 3.17.3
---------------------------

1) Fix memory leak in Skiplist. Reported by Taj Khattra, patch by Theo 
   Schlossnagle.

2) spuser,spflooder, and spmonitor fixed to print correct name in help. 
   Patch by Daniel Rall.

3) Fix incorrect alarm printing where WARNING messages generated by
   older Alarm() interface were not printed.

4) Modify monitor so it will run correctly on Windows. This was done
   by modifying monitor.c so it can also build as a threaded program
   and on windows will use multiple threads to send/recv updates and
   get user imput. (A POSIX thread option is also added).

5) Fix a bug in the Windows build using VC++ of thread-safe
   libtspread.lib.  Bug and fix by Jacob Green.

6) Fix bug in libspread where if the groups array or message body
   passed to SP_recv* was too small, the mess_type field returned
   would be truncated and the sender field was not returned. They are
   both now returned correctly.  Bug report and partial fix provided
   by John Schultz.

7) Fix bug where SP_Join and SP_Leave do not report an error if a
   group name is too long (instead they truncated it) Reported with
   fix by David Parker.  ** Warning, this could break buggy
   applications who use long groups and assume the name is truncated.

8) Cleanup compile warnings where E_queue() used with no-parameter
   functions (not all uses fixed) and fix incorrect use of signed int
   with strlen().

9) Fix few cases in flooder.c and user.c that did not use the defined
   MAX_MESSLEN constant. Tested to verify that increasing
   MAX_SCATTER_ELEMENTS in scatter.h and the MAX_MESSLEN defines in
   user.c and flooder.c is sufficient to support arbitrarily large
   message sizes with Spread. This is NOT recommended, but several
   people do it anyway :-)

10) Add new option to spflooder. The -n option allows a fixed "number
    of members" to be set. This then activates a multi-sender flow
    control algorithm to allow flooding tests with several
    senders. All of the processes need to join the group (i.e. they
    cannot be -wo (write-only)) but not all processes have to send.
    This allows easy testing with differing numbers of senders (just
    change how many spflooders start with -ro and how many do not).

11) Make E_delay() work on Win32.

12) Added check that a segment using localhost (i.e. 127.0.0.255) is
    NOT in a spread.conf with any other segments using real IP
    addresses. This configuration will not work correctly and is
    usually because the example localhost configuration provided with
    Spread is added to. This check will cause the daemon to exit
    immediately after parsing the config file.

13) Add new Alarm priority flag to print a line with no datestamp (for
    multi-line output).

14) Fix bug where if more then 22 daemons start at the same time, some
    will crash or the membership will not complete correctly. This bug
    was reported by several people including Jesse Noller.

15) Fix Java spread connection problem where several threaded
    connections from same process cause unexpected connection
    failures. Reported by Brian Moseley, idea of fix by Ryan Caudy,
    patch by Jonathan Stanton.

16) Fix EVS bug where AGREED messages may be delivered before a
    transitional signal on some daemons and after it on others. Bug
    found and patch created by Ryan Caudy.

17) Make SP_connect_timeout() calls non-blocking for the actual
    'connect()' call.  This should fix the issue reported by Shlomi
    Yaakobovich where a hung daemon causes new connections to also
    hang in connect. Also includes slight cleanup of connect code
    path.

18) Add new Windows VC++.Net project files to
    daemon/win32_msvc_net. The current project files in daemon/win32
    remain as they can be used in VC++ (version 6).

March 5, 2004 Ver 3.17.2:
--------------
1) Fix daemon quit when multiple interfaces are configured as "D" daemon 
   interfaces in the spread.conf file. Bug reported by Orit Wasserman.
2) Updated url for Java 'ant' build system. Patch by Daniel Rall.
3) Fix group_id bug that causes incorrect vs_sets. Patch by Ryan Caudy.
4) Fix spread.conf parser so it validates the machine names in segments
   and forces them to be less then MAX_PROC_NAME. Patch by Mikhail Terekhov.
5) Minor fix to Mac OS X compilation so library softlinks do not fail the 
   second time make is run.
6) Alarm() changes to support priority levels on each Alarm() call. 
7) Fix crash by improving packet accounting when a client connected to a 
   singleton daemon sends a large broadcast. Reported by David Shaw.
8) Fix bus errors on Sparc & Alpha for message buffer integer assignment. 
   Reported by Greg Shebert; tested and patched Mikhail Terekhov.
9) Verify daemon names in spread.conf are unique. If non-unique names are
   provided in spread.conf, configuration will be rejected and daemon will 
   not start. Suggested by Tim Peters. 
10) Zero buffer in c library before sending multicast. 
    Reported by Panagiotis Kougiouris. 
11) Send fewer lookup probe messages when only a single segment is configured.
12) Remove extra token rotations when no messages are sent. Will decrease
    network packet overhead. 
13) Make mailbox and service in sp.h a typedef instead of a #define. Suggested
    and patched by Steven Dake. 
14) Fix small endianness error in sp.c where the mess_type field may not be
    correctly converted for different endian platforms when the SP_*_recv calls
    return a BUFFER_TOO_SHORT or GROUPS_TOO_SHORT error.
15) Change alarm tag for security prints from SEC to SECURITY because of conflict
    with sys/time.h header.
16) Documentation fix to SP_receive man page to correct fields for self-leave
    membership messages.
17) Update of email addresses in copyright statements and headers.
18) Windows binary libraries now built as libspread and libtspread like other
    platforms. 

June 20, 2003 Ver 3.17.1
----------------------------
Bugfixes:
*) Fix memory corruption and crash with groups of large size.
*) Correct make install so it installs header files.
*) Fix syntax error in build.xml file for Java/Ant.
*) Cleanup prototypes to remove compiler warnings.
*) Fix parser to correctly recognize upper, lower, and mixed case command options.
*) During make install, remove old symlinks.
*) Change setgroups call to be more portable. (fixes MacOSX)
*) Change name of r and s to sprecv and spsend, and add as make targets. 
   They can be built by "make testprog" (not built by default).
*) Work on making long group names possible. 
*) Increase listen backlog for accepting client connections.
*) Fix Win32 project files to have correct path to source files. 
   (note CVS was always ok, but 3.17.0 release had incorrect path)
*) Fix bug where large groups overflow Mess_buf in groups.c.
*) Fix memory corruption bug when a message header is received in
   several separate packets in session.c. Thanks to Ryan Caudy for 
   many, many hours tracking this down.
*) Change order of build in Makefile so binaries are built before
   documentation.
*) Fix Java bug where connection objects cannot be disconnected and
   then reconnected, but must be created anew. They can now be reused.
*) Fix compile error on AIX for struct if_info.
*) Fix security issue with buffer checks in the C library. 
*) Fix obscure off-by-one buffer error with the parser. 

September 25, 2002 Ver 3.17.0
----------------------
Features:
1) Apply Daniel Rall's SO_REUSEADDR patch. This adds a new configuration
   option SocketPortReuse that can either force SO_REUSEADDR on or off
   for TCP server sockets, or set it to an auto mode that uses REUSEADDR
   if specific interfaces are specified in the spread.conf file and
   does not use it if the default of INADDR_ANY is used. If you force
   this on, be aware that it can open up a security risk where other
   processes can steal Spread's traffic.
2) Enhance the group membership algorithm so very large groups and very large
   numbers of groups will be merged correctly during a membership. 
   With this change Spread should correctly handle groups with thousands
   of members and thousands of groups. This also includes a slight 
   optimzation by sending groups messages as AGREED instead of SAFE.
   Thanks to Ryan Caudy from JHU for doing this work.
3) Revamped build setup using autoconf instead of manual Makefiles. Thanks
   to Theo Schlossnagle for writing this and updating it. Some small changes
   were made to Theo's 3.16.2 patch when I applied it.
4) Change library name from libsp to libspread. This is both more descriptive
   and should fix the problem with library clashes with other libsp's.
5) Apply Daniel Rall's patch to make the spread execution directory and
   the user and group it runs as configurable at runtime.

Bugfixes: 
6) Make sure service_type is set to 0 before using it in SP_receive calls 
   in sample programs (spuser, spflooder, simple_user).
7) Fix GGT bug where Spread gets stuck or crashes if you reach GGT state.
8) Fix Mem_Alloc blocks so they can be freed without assertion failure.
9) Fix hanging bug where token rotates, but ARU is stuck.

Documentation:
10) Split the growing changelog at the beginning of Readme.txt into a 
    separate file.
11) Updates to man pages. Clarify service_type handling. Add info on accessor
    functions for membership message body.

April 2, 2002 Ver 3.16.2 (The Almost April Fools Release)
---------------------------
Bugfixes:
1) All recv calls in session now check for EWOULDBLOCK, EAGAIN, EINTR 
   and retry the call later. This fixes problem on busy servers where 
   connections would be killed erroneously. Thanks to the Zope team 
   (Guido van Rossum, Tim Peters, and Jeremy Hylton) for discovering this
   and helping with fixing it.
2) log.c file operations now check for errors and handle them.
3) Windows bugs:
   a) close() does not close sockets, we need to call closesocket() to avoid
      memory leak.
   b) sockets are not consecutive fd's on windows, they can be > FD_SETSIZE.
      So fd mapping to sessions changed to use a hash instead of array. 
      As a side-effect it should be faster to connect/disconnect. 
      Thanks to Marc Zyngier for discovering the problem and writing and 
      testing a patch for it.
   c) Raise the FD_SETSIZE for windows to 1024 by #defining it in arch.h.
   d) Enhanced error handling to support WSAGetLastError, and define a
      sock_strerror() function to return nice error strings on windows.
   e) Include Visual C++ Project files to build Spread on Windows.
4) Included improved NetBSD makefile and warning fix from Patrick Welche.
5) Generalize the errno handling to support windows errors and other 
   odd cases. Also see fix 3d. Thanks to Marc Zyngier, Tim Peters, and
   David Holmer for help with this.
6) Improve the install targets for linux. Now install include headers
   and use standard PREFIX define for base directory.
7) Updates to man pages. New libsp manpage.

December 11, 2001 Ver 3.16.1  
------------------------
Bugfixes:
1) Fix various races and bugs in the new authentication and access control 
   code. 
   a) Fix session establishment races with authentication
   b) Add more info for access control hooks to use (mess_type and num_groups)
   c) Fix so rejected messages are not still delivered to local group members.
   d) Make reject messages honor SELF_DISCARD.
   e) Fix bug that always allowed NULL connections.
2) SGI now builds using signed chars and reports errors correctly.
3) MacOSX build fixed. 
4) Fixed race at session establishment that caused the assertion failure
   "assert( xxxxx ) false "
5) Add MAX_MESSAGE_BODY_LEN to spread_params.h (used in sp.c checks), move
   MAX_PACKET_SIZE to spread_params.h from arch.h.
6) Fixed interface restrictions for daemons. 
7) Fixed crashes in user and flooder programs when wrong number of command
   line parameters were passed.
8) Added assertion check for Groups membership message with zero members in a group. (Theo)
9) Java library fixes and enhancements (Thanks to Dan Rall and Leonard
	Richardson )
10) Fix bug in group name validator G_private_to_names that caused crash.
11) Fix for reversed parameters to memset in groups.c (Thanks to Marc Zyngier)
12) Fix bug in session connection that confused closed, but not yet deleted file 
    descriptors with newly accepted connections. (Thanks to Dave Parker for discovering bug).
13) Fix significant memory leak when connections are disconnected. This
    leak has been present since at least 3.15.0. (Thanks to Dave Parker
    for discovering this and providing lots of assistance debugging it.)
14) Fix the binding to specific interfaces to work with broadcast packets. 
    (Thanks to Marc Zyngier for reporting the problem)
15) Updated man pages and Users Guide
16) Added makefile for OpenBSD contributed by Brandon Palmer.
17) Added makefile for Solaris 8 with Solaris cc compiler 6.1 contributed by Luc I. Suryo.


June 25, 2001 Ver 3.16.0
-------------------------
Changes:
1) Add support for configuring multiple interfaces on daemons. Each daemon
   can now choose which interfaces to listen on for client connections, monitor
   requests, and daemon-to-daemon communication.
2) Added support for MacOSX. Thanks to Julien Defour and Dirk-Willem van Gulik.
3) Agreed messages for join/leave instead of SAFE messages.
4) Fixed bug with membership messages for more then 42 members in a group.
5) Document how to monitor packing effectiveness.
6) SP_connect assigns unique private name if user gives a zero length string as
   the user name.
7) Slightly loosen valid field checking for service_type field to allow
   flush and secure spread libraries to work.
8) Fix events to work with low priority events for Splash.
9) Adds modular access control and authentication system that allows the 
   daemon to authenticate client connections and allow or disallow various
   actions (such as joining groups, sending messages or connecting) based
   on the authenticated user. This changes the client-server network
   protocol, but is backward compatible with clients linked with old libraries.
   This also adds new functions to the API. A sample module that
   provides access control based on the IP address of the client is 
   included. Also a module that provides the same "allow all clients" 
   policy as older versions of Spread. The Java API has also been 
   updated to support the new access control framework.
10) New license for Spread. BSD based open-source license.
11) Updated Perl library with some bug fixes and compatibility with new C lib.
12) Added support for 64 bit platforms (alpha, ultrasparc & ia64) Note only
    alpha is actually tested.
13) Fix bug in sp.c where if a message was not completely received because 
    of a short buffer and the next call had an invalid message scatter the
    data in the messages would get corrupted. Probably difficult to trigger 
    unless you are trying hard.
14) Changed names of programs included with spread to have "sp" as a prefix.
    This should help avoid conflicts with all the other utilities called 
    "user" or "monitor".
15) Small bugfixes to the Java library. 
16) Bugfix which removes a costly, and unnecessary, recalculation when 
    several network level membership events occur in close (time) proximity.
 
March 20, 2001 Ver 3.15.2
-------------------------

Changes:
1) Bugfix to java library to fix exception caused when trying to establish
   connection. This is a new bug in 3.15.1. Thanks to Julien Dufour.
2) Add #define SPREAD_VERSION to sp.h so client applications can test for
   what version of the spread API to use. This allows applications to compile
   against multiple incompatible versions of the spread library. Specifically,
   this can be used for an app to support both the old 'float SP_version()'
   and new 'int SP_version(int, int, int)' functions.
3) Fix memory leak in Perl module. Thanks to Theo Schlossnagle.

February 26, 2001 Ver. 3.15.1
-----------------------------
Changes:
1) Make sess_read() non-blocking so slow clients sending messages don't slow
   or block daemon.
2) Implement input validation on all messages received from clients. This
   is to address the possibility of clients overflowing the servers buffers.
   These problems were uncovered in a security audit by Olaf Kirch of Caldera.
3) Use chroot to isolate spread and drop priveledges if spread is run by root.
   If it is run as a normal user, then no chroot is done and it runs just as 
   before. The user to run as and the location of the chroot jail can be 
   configured in the spread_params.h file at compile time.
4) Fix a bug that causes a significant memory leak when retransmissions are 
   required. This memory leak exists in versions 3.13, 3.14 and 3.15.0.
5) SP_version() no longer returns a float, instead it returns in 3 separate
   parameters the 3 components of the version number.
 
December 20, 2000 -- Unreleased 3.15.0
-----------------
Changes:
1) New version number scheme with 3 components: Major, Minor, and Patch.
2) Small bugfix to prevent clients from sending to too many groups and
   crashing spread.
3) Copyright changed to Spread Concepts LLC for code by original
   developers.

0ctober 31, 2000 
---------------
Changes:
1) Bugfixes to skiplist implementation.
2) Critical fixes to group membership that removes bugs introduced in 
   optimization work of 3.13.
3) Critical bugfix to membership which solves problem introduced in 3.13 
   with using configurations of more then one segment.
4) Changes to spread.conf parser, but nothing that should be user visable.
5) Better error/problem reporting in a few cases.
6) Enforce message length limit. SP_mcast* will now return an error
   if a message body is too long.
7) Minor memory leak at initialization fixed.
8) Fix to events.c to prevent an illegal message bug. Bug is triggered
   when messages are sent very fast during a membership merge.

August 07, 2000
---------------
Changes:
1) To compile the Linux version on systems based on glibc2.0 (such as 
   RedHat 5.2) you need to comment out the #define of HAVE_STDINT_H in the 
   arch.h file before compiling.

2) Major scalability improvements. Should now support upto 990 connections
   to each daemon, thousands of groups, and faster throughput with
   small messages.

3) Configuration file changes. 
	a) The default name of the configuration file 
	   has changed from config.dat to spread.conf. The default locations 
	   checked if nothing is specified on the command line is 
	   /etc/spread.conf and ./spread.conf (i.e. the current directory 
	   where the binary is run from).
	b) The format of the spread.conf file is improved. You no longer
	   have to specify the number of members of a segment or the number
	   of segments by hand. The format is also more standard and has a 
	   lex/yacc grammer defining it. See the sample.spread.conf file 
	   for an example or the documention for details.
	c) More configuration variables. 
		EventLogFile: You can now have all the Spread event messages 
			      that print to the screen print to a file instead.
			      To have each daemon log to a separate file use the
			      '%h' or '%H' special characters in the log filename.
			      Spread will replace those characters with the hostname
			      of the machine which the daemon is running on. An 
			      example can be found in the sample.spread.conf file.
		DebugFlags: The event mask that determines which messages
			    to print to the screen is now configurable at
			    runtime.
		EventTimeStamp: Add a timestamp in front of all logged event 
				messages and set the format of the timestamp.

		DangerousMonitor: Certain monitor commands like partition, kill
				  and flow_control are disabled by default now.
				  To enable them set this to true.

4) Fix membership bug when under high load and a late data message arrives.
   Also fix membership bug where the assertion 
"spread: membership.c:1835: Backoff_membership: Assertion `pack_entry != -1' failed."
   triggered.
   Also fix membership bug where several machines will get trapped in 
   State 3 (GATHER state) and will never complete the membership.

5) Some documentation on how to tune Spread using some of the internal variables.
   This is contained in the new Spread User Guide Chapter 2 which can be 
   downloaded from www.spread.org.

6) Fix bug in new No Drop semantics. When a BUFFER_TOO_SHORT error occured
   the endian_mismatch field was incorrectly set to the size of the app buffer
   instead of the size of the data message. So it was useless. This is fixed and
   the semantics are extended to set the num_groups and endian_mismatch fields to 0
   if the corresponding buffers ARE large enough, and to the needed size 
   (as a negative) when they are NOT large enough. This allows you to know when 
   you receive a GROUPS_TOO_SHORT whether the buffer is also too short without 
   any calculation...Just check if endian_mismatch is 0.

7) License updated to version 1.2. The only change is a small addition to the
   attribution requirement, a capitalization of Spread, and a clarification of
   the Spread version.

May 01, 2000
---------------
Changes:
1) Integrated FreeBSD port. A Big thanks to Ben Laurie <ben@algroup.co.uk>
   for this port and a lot of compile warnings, type cleanups and 2 bugfixes.

2) Removed some compile warnings.

3) 2 bugs fixed. One in SP_group_ids_equal() and one in the 
   daemon that would never trigger in reality.

4) Updated java interface to most recent version.

5) Updated events (E_* functions) to most recent version. This
   adds the ability to attach to file descriptors for 
   Exceptions and Write events as well as reads. It also 
   adds a void* data pointer to the callback parameters.

6) Change SP_recv semantics to be "No Drop" by default. The 
   old "drop" semantics are still available by setting the 
   service_type parameter to SP_recv to DROP_RECV before calling it.
   *** 
   See the file "Short_Buffer_Handling.txt" for detailed comments
   on this change and what application modifications might be necessary
   ***

7) Documentation updates.

8) Changed the way arch.h is implemented. This might require 
   some additions for Ports that we do not support natively.

9) Added Is_self_leave() macro which matches documentation for testing
   self-leaves.

10) Changed SP_* and E_* functions to use 'const' appropriately.

11) Reserved fields are listed in sp.h to prevent collisions.

12) Make MAX_PROC_NAME and MAX_PRIVATE_GROUP sizes available in sp.h.

13) Added Perl library interface. You can now write Spread client 
    programs in perl. Thanks to Theo Schlossnagle <theos@cnds.jhu.edu>.

14) License updated to version 1.1. Main change is a reformatting and 
    updated email addresses. 

July 27, 1999 Official Release
---------------------------------------------------

1) Has new license (license.txt) and copyright notices

2) New Java interface included

3) Location of license has moved to: 
	    http://www.spread.org/license/
	    http://www.cnds.jhu.edu/spread/license/

4) Minor documentation and example program improvements.

5) One minor bug fixed in group handling.

May 26, 1999 Release:
---------------------
1) Expiration Date Removed from Binary version
   This release of the executatbles will not expire.

2) New Copyright Statement
   The copyright of Spread has been finalized. The statement at the top of 
   this file shows it.

3) Source release soon & new license
   a) As soon as a few final issues are resolved we will release the source
      to Spread under the CNDS Non-Commercial and Development License. 
   b) A draft of the new license can be found at 
      http://www.cnds.jhu.edu/spread/CNCL/.
      Please email us any comments or concerns you have at spread@spread.org

4) Bugs Fixed:
   a) Bug fix to the SP_scatter_recv() call to make receives into 
      scatter structures of multiple entries of different sizes work.
   b) The Linux platform also had scatter-gather functionality enabled 
      (now that glibc has working sendmsg, recvmsg calls)
   c) Fixed bug where packets which are delayed a long time in the network
      but then actually arrive at a spread daemon cause a crash.


October 30,1998 Release:
-----------
1) Multi-threading:
   Libsp.a has split into two libraries, libsp.a and libtsp.a, they
   are identical except that libtsp.a is thread-safe and libsp.a is not.
   Both versions are provided so that single-threaded programs who don't 
   need a safe library can avoid the (admittedly pretty small) overhead of 
   locking. The libtsp.a can be used identically with libsp.a with the 
   addition that all SP_* functions can be called by multiple threads 
   at the same time.  Thread safety in libtsp.a is provided optimally,
   with the most possible parallelism allowed.  Threads acting on separate
   mailboxes will never block each other, threads writing to a mailbox will
   never block other threads reading from the same mailbox and vice versa.
   The one time thread calls to SP_ functions will be serialzed is when 
   multiple threads are reading the same mailbox or writing the same mailbox.
   There is minimal locking of internal structures which can temporarily 
   block another thread, but since a thread never blocks while in one of 
   these structure critical sections and the duration of the lock is at 
   most a fewinstructions the delay should be minimal.  
   
2) IP-Multicast:
   Spread now allows you to specifiy IP-Multicast addresses(i.e. 224.0.0.1) 
   as the broadcast address for a segment in the spread.conf file. This will 
   work transparently in the same segment, and is guaranteed not to spill 
   multicast packets beyond that segment. If multi-segment ip-multicast is 
   desired, please contact us.

3) Fixed several minor bugs.

4) Included man pages for SP functions. The old html documentation is also 
   included.

5) None of these changes effect the Java version which has not changed.
